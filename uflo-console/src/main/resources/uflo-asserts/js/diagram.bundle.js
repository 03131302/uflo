!function(t){function r(a){if(e[a])return e[a].exports;var n=e[a]={exports:{},id:a,loaded:!1};return t[a].call(n.exports,n,n.exports,r),n.loaded=!0,n.exports}var e={};return r.m=t,r.c=e,r.p="",r(0)}([function(t,r){"use strict";function e(t){switch(t){case 0:return 0;case 1:return"①";case 2:return"②";case 3:return"③";case 4:return"④";case 5:return"⑤";case 6:return"⑥";case 7:return"⑦";case 8:return"⑧";case 9:return"⑨";case 10:return"⑩";case 11:return"⑪";case 12:return"⑫";case 13:return"⑬";case 14:return"⑭";case 15:return"⑮";case 16:return"⑯";case 17:return"⑰";case 18:return"⑱";case 19:return"⑲";case 20:return"⑳"}return t}window.ProcessDiagram=function(){},ProcessDiagram.prototype.show=function(t,r,e){this.containerId=t,r||alert("parameters can not be null.");var a=this;e||(e=""),this.contextPath=e;var n=e+"/diagram/loadDiagramData";$.ajax({url:n,data:r,type:"POST",success:function(t){a._buildDiagram(t)},error:function(t,r,e){alert("Error:"+r)}})},ProcessDiagram.prototype._buildDiagram=function(t){var r={};this.paper=new Raphael(document.getElementById(this.containerId),t.width,t.height);for(var e=t.nodeDiagrams,a=0;a<e.length;a++){var n=e[a],i=this._buildNode(n,t.showTime);r[n.name]=i}for(var a=0;a<e.length;a++){var n=e[a],o=n.sequenceFlowDiagrams;if(o)for(var s=0;s<o.length;s++){var h=o[s],c=h.to,u=r[c];if(!u)throw new Error("Node "+c+" is not exist.");var l=r[n.name];if(!l)throw new Error("Node "+l+" is not exist.");this._buildConnection(l,u,h)}}},ProcessDiagram.prototype._buildConnection=function(t,r,e){var a=t.attr("x")+t.attr("width")/2,n=t.attr("y")+t.attr("height")/2,i=r.attr("x")+r.attr("width")/2,o=r.attr("y")+r.attr("height")/2,s=i,h=o,c=e.points;c&&c.length>0&&(s=c[0].x,h=c[0].y);var u="M "+a+" "+n+" L "+s+" "+h,l=this._getRectEdgePathInfo(t),p=Raphael.pathIntersection(u,l),g="M "+p[0].x+" "+p[0].y,d=[];if(d.push({x:p[0].x,y:p[0].y}),c)for(var x=0;x<c.length;x++){var f=c[x];g+=" L "+f.x+" "+f.y,d.push(f)}if(c&&c.length>0){var y=c[c.length-1];a=y.x,n=y.y}var v="M "+a+" "+n+" L "+i+" "+o,m=this._getRectEdgePathInfo(r),b=Raphael.pathIntersection(v,m);d.push({x:b[0].x,y:b[0].y}),g+=" L "+b[0].x+" "+b[0].y;var w=e.labelPosition;if(w){var f=w.split(",");if(2==f.length){var I,P,D=d.length;if(D%2==0){var _=d[D/2-1],B=d[D/2];I=Math.abs(_.x-B.x)/2+(_.x>B.x?B.x:_.x)+parseInt(f[0]),P=Math.abs(_.y-B.y)/2+(_.y>B.y?B.y:_.y)+parseInt(f[1])}else{var y=d[parseInt(D/2)];I=y.x+parseInt(f[0]),P=y.y+parseInt(f[1])}var L=e.name;if(L){var E=this.paper.text(I,P,L);E.attr("font-size",parseInt(e.fontSize));var M=E.getBBox().width,C=E.getBBox().height;E.attr({x:I+M/2,y:P+C/2,fill:"rgb("+e.borderColor+")"})}}}var R=this.paper.path(g);return R.attr({"arrow-end":"block-wide-long","stroke-width":e.borderWidth,stroke:"rgb("+e.borderColor+")"}),R},ProcessDiagram.prototype._getRectEdgePathInfo=function(t){var r=t.attr("x"),e=t.attr("y"),a=t.attr("x")+t.attr("width"),n=t.attr("y"),i=t.attr("x")+t.attr("width"),o=t.attr("y")+t.attr("height"),s=t.attr("x"),h=t.attr("y")+t.attr("height");return"M "+r+" "+e+" L "+a+" "+n+" L "+i+" "+o+" L "+s+"  "+h+" L "+r+"  "+e},ProcessDiagram.prototype._buildNode=function(t,r){var a=t.width,n=t.height,i=t.icon;i=this.contextPath+"/res"+i;var o,s,h=this.paper.rect(t.x,t.y,a,n,5),c=t.x+a/2,u=t.y+n/2,l=e(t.time),p=t.name;t.label&&t.label.length>0&&(p=t.label),h.attr("stroke-width","0"),o=this.paper.text(c,u+16,p),o.attr("font-size",parseInt(t.fontSize));var g=o.getBBox().height,d=c-16,x=u-g/2-16;if(s=this.paper.image(i,d,x,32,32),0!=l&&r){var f=this.paper.text(t.x+a-15,t.y,l);f.attr("font-size","16")}o.attr({fill:"rgb("+t.fontColor+")"});var y=t.fontBold;if(y){var v=this._buildTextUnderline(o);v.attr("stroke","rgb("+t.fontColor+")")}return t.info&&(s.attr("title",t.info),h.attr("title",t.info)),h},ProcessDiagram.prototype._buildTextUnderline=function(t){var r=t.getBBox(),e=this.paper.path("M"+r.x+" "+(r.y+r.height)+"L"+(r.x+r.width)+" "+(r.y+r.height));return e}}]);